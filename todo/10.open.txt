type: bug
status: open
subject: BG Editor Scale Issues
description: |
  Two bugs related to the BG Editor scale feature:

  ## Bug 1: Switching scale doesn't display existing bg-items

  **Symptom**: When switching scale, no existing bg-item is displayed until a new bg-item is placed.

  **Cause**: Canvas dimensions are updated through Vue reactivity, but `renderGrid()` may execute before the canvas dimensions are actually updated in the DOM.

  **Solution**: Need to render after `nextTick`, or watch for canvas dimension changes.

  **File**: `src/features/bg-editor/components/BgGrid.vue`

  ## Bug 2: 1.75x scale causes display corruption (花屏)

  **Symptom**: Using 1.75x scale causes corrupted/garbled display.

  **Cause**: The rendering code assumes integer scale factors. Pixel index calculation `((row * scale + sy) * scaledCellSize + col * scale + sx) * 4` fails for non-integer scales:
  - `8 * 1.75 = 14` pixels
  - But the loop `for (let sy = 0; sy < scale; sy++)` doesn't work for non-integers

  **Solution**: For non-integer scales, render to original size canvas first, then use `drawImage` to scale.

  **File**: `src/features/bg-editor/composables/useBgRenderer.ts`
